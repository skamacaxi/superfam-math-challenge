<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Superfam Math Speed Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen transition-colors duration-200">
    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Superfam Math Speed Challenge</h1>
            <p class="text-gray-600 dark:text-gray-400">Answer 30 single-digit multiplication questions as fast and accurately as possible!</p>
        </div>

        <!-- Start Screen -->
        <div id="startScreen" class="text-center">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-8 mb-6">
                <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Ready to begin?</h2>
                <p class="text-gray-600 dark:text-gray-400 mb-4">You'll have 30 multiplication questions. Use your keyboard or click the number buttons to answer. Good luck!</p>
                
                <div class="mb-6">
                    <label for="usernameInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Enter your name:</label>
                    <input type="text" id="usernameInput" class="text-base text-center border-2 border-gray-300 dark:border-gray-600 rounded-lg py-3 px-4 w-64 max-w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:border-primary focus:outline-none" placeholder="Your name" maxlength="20">
                </div>
                
                <button id="startBtn" class="bg-primary hover:bg-primary/90 text-white font-semibold py-3 px-8 rounded-lg transition-colors duration-200">
                    Start Challenge
                </button>
            </div>
            
            <!-- Leaderboard -->
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">üèÜ Top 10 Leaderboard</h3>
                <div id="leaderboard" class="space-y-2">
                    <div class="text-gray-500 dark:text-gray-400 text-sm">No records yet. Be the first!</div>
                </div>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen" class="hidden">
            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2">
                    <span>Question <span id="currentQuestion">1</span> of 30</span>
                    <span>Time: <span id="timer">0:00</span></span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                    <div id="progressBar" class="bg-primary h-2 rounded-full transition-all duration-300" style="width: 3.33%"></div>
                </div>
            </div>

            <!-- Question -->
            <div class="text-center mb-8">
                <div class="text-4xl font-bold text-gray-900 dark:text-white mb-4" id="question">7 √ó 8 = ?</div>
                <input type="number" id="answerInput" class="text-2xl text-center border-2 border-gray-300 dark:border-gray-600 rounded-lg py-3 px-4 w-32 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:border-primary focus:outline-none" placeholder="?" autofocus>
            </div>

            <!-- Number Pad -->
            <div class="grid grid-cols-3 gap-3 max-w-xs mx-auto mb-6">
                <button class="num-btn bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-4 rounded-lg transition-colors duration-200" data-num="1">1</button>
                <button class="num-btn bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-4 rounded-lg transition-colors duration-200" data-num="2">2</button>
                <button class="num-btn bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-4 rounded-lg transition-colors duration-200" data-num="3">3</button>
                <button class="num-btn bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-4 rounded-lg transition-colors duration-200" data-num="4">4</button>
                <button class="num-btn bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-4 rounded-lg transition-colors duration-200" data-num="5">5</button>
                <button class="num-btn bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-4 rounded-lg transition-colors duration-200" data-num="6">6</button>
                <button class="num-btn bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-4 rounded-lg transition-colors duration-200" data-num="7">7</button>
                <button class="num-btn bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-4 rounded-lg transition-colors duration-200" data-num="8">8</button>
                <button class="num-btn bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-4 rounded-lg transition-colors duration-200" data-num="9">9</button>
                <button id="clearBtn" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-4 rounded-lg transition-colors duration-200">Clear</button>
                <button class="num-btn bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-900 dark:text-white font-semibold py-4 rounded-lg transition-colors duration-200" data-num="0">0</button>
                <button id="submitBtn" class="bg-primary hover:bg-primary/90 text-white font-semibold py-4 rounded-lg transition-colors duration-200">Submit</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="hidden text-center">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-8 mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Challenge Complete! üéâ</h2>
                
                <div class="grid grid-cols-2 gap-6 mb-6">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-primary mb-2" id="finalTime">0:00</div>
                        <div class="text-gray-600 dark:text-gray-400">Time</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-primary mb-2" id="finalAccuracy">0%</div>
                        <div class="text-gray-600 dark:text-gray-400">Accuracy</div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <div class="text-4xl font-bold text-green-600 dark:text-green-400 mb-2" id="finalScore">0</div>
                    <div class="text-gray-600 dark:text-gray-400">Your Score</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">Formula: (Correct √ó 1000) √∑ Time</div>
                </div>

                <div class="mb-6">
                    <div class="text-lg text-gray-700 dark:text-gray-300">
                        <span id="correctCount">0</span> out of 30 correct
                    </div>
                </div>

                <button id="playAgainBtn" class="bg-primary hover:bg-primary/90 text-white font-semibold py-3 px-8 rounded-lg transition-colors duration-200 mr-4">
                    Play Again
                </button>
                <button id="viewLeaderboardBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-8 rounded-lg transition-colors duration-200">
                    View Leaderboard
                </button>
            </div>
        </div>
    </div>

    <script>
        class MathQuiz {
            constructor() {
                this.questions = [];
                this.currentQuestionIndex = 0;
                this.startTime = null;
                this.correctAnswers = 0;
                this.leaderboard = [];
                this.timerInterval = null;
                this.firebaseInitialized = false;
                
                this.initializeFirebase();
                this.initializeEventListeners();
                this.generateQuestions();
                this.loadLeaderboard();
                this.updateLeaderboard();
            }

            initializeEventListeners() {
                document.getElementById('startBtn').addEventListener('click', () => this.startQuiz());
                document.getElementById('submitBtn').addEventListener('click', () => this.submitAnswer());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearAnswer());
                document.getElementById('playAgainBtn').addEventListener('click', () => this.resetQuiz());
                document.getElementById('viewLeaderboardBtn').addEventListener('click', () => this.showStartScreen());

                // Number pad buttons
                document.querySelectorAll('.num-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const num = e.target.dataset.num;
                        this.addDigit(num);
                    });
                });

                // Keyboard input
                document.addEventListener('keydown', (e) => {
                    if (document.getElementById('quizScreen').classList.contains('hidden')) return;
                    
                    // Only handle keys if the answer input is focused and prevent default to avoid double entry
                    if (document.activeElement === document.getElementById('answerInput')) {
                        if (e.key >= '0' && e.key <= '9') {
                            e.preventDefault();
                            this.addDigit(e.key);
                        } else if (e.key === 'Enter') {
                            e.preventDefault();
                            this.submitAnswer();
                        } else if (e.key === 'Backspace' || e.key === 'Delete') {
                            e.preventDefault();
                            this.clearAnswer();
                        }
                    }
                });

                // Input field events
                document.getElementById('answerInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.submitAnswer();
                    }
                });
            }

            generateQuestions() {
                this.questions = [];
                for (let i = 0; i < 30; i++) {
                    const num1 = Math.floor(Math.random() * 9) + 1; // 1-9
                    const num2 = Math.floor(Math.random() * 9) + 1; // 1-9
                    this.questions.push({
                        num1: num1,
                        num2: num2,
                        answer: num1 * num2
                    });
                }
            }

            startQuiz() {
                const username = document.getElementById('usernameInput').value.trim();
                if (!username) {
                    this.showCustomAlert('Please enter your name before starting the quiz!');
                    return;
                }
                
                this.currentUsername = username;
                this.showQuizScreen();
                this.startTime = Date.now();
                this.currentQuestionIndex = 0;
                this.correctAnswers = 0;
                this.displayQuestion();
                this.startTimer();
            }

            showQuizScreen() {
                document.getElementById('startScreen').classList.add('hidden');
                document.getElementById('quizScreen').classList.remove('hidden');
                document.getElementById('resultsScreen').classList.add('hidden');
                document.getElementById('answerInput').focus();
            }

            showStartScreen() {
                document.getElementById('startScreen').classList.remove('hidden');
                document.getElementById('quizScreen').classList.add('hidden');
                document.getElementById('resultsScreen').classList.add('hidden');
            }

            showResultsScreen() {
                document.getElementById('startScreen').classList.add('hidden');
                document.getElementById('quizScreen').classList.add('hidden');
                document.getElementById('resultsScreen').classList.remove('hidden');
            }

            displayQuestion() {
                const question = this.questions[this.currentQuestionIndex];
                document.getElementById('question').textContent = `${question.num1} √ó ${question.num2} = ?`;
                document.getElementById('currentQuestion').textContent = this.currentQuestionIndex + 1;
                document.getElementById('answerInput').value = '';
                document.getElementById('answerInput').focus();
                
                // Update progress bar
                const progress = ((this.currentQuestionIndex + 1) / 30) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
            }

            addDigit(digit) {
                const input = document.getElementById('answerInput');
                input.value += digit;
            }

            clearAnswer() {
                document.getElementById('answerInput').value = '';
            }

            submitAnswer() {
                const userAnswer = parseInt(document.getElementById('answerInput').value);
                const correctAnswer = this.questions[this.currentQuestionIndex].answer;
                
                if (userAnswer === correctAnswer) {
                    this.correctAnswers++;
                }

                this.currentQuestionIndex++;
                
                if (this.currentQuestionIndex < 30) {
                    this.displayQuestion();
                } else {
                    this.endQuiz();
                }
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    document.getElementById('timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            }

            endQuiz() {
                clearInterval(this.timerInterval);
                const totalTime = Math.floor((Date.now() - this.startTime) / 1000);
                const accuracy = Math.round((this.correctAnswers / 30) * 100);
                const score = Math.round((this.correctAnswers * 1000) / totalTime);
                
                // Display results
                const minutes = Math.floor(totalTime / 60);
                const seconds = totalTime % 60;
                document.getElementById('finalTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('finalAccuracy').textContent = `${accuracy}%`;
                document.getElementById('finalScore').textContent = score;
                document.getElementById('correctCount').textContent = this.correctAnswers;
                
                // Add to leaderboard
                this.addToLeaderboard(score, totalTime, accuracy, this.correctAnswers);
                
                this.showResultsScreen();
            }

            addToLeaderboard(score, time, accuracy, correct) {
                const entry = {
                    username: this.currentUsername,
                    score: score,
                    time: time,
                    accuracy: accuracy,
                    correct: correct,
                    date: new Date().toLocaleDateString()
                };
                
                this.leaderboard.push(entry);
                this.leaderboard.sort((a, b) => b.score - a.score);
                this.leaderboard = this.leaderboard.slice(0, 10); // Keep only top 10
                
                this.updateLeaderboard();
                this.saveLeaderboard();
            }

            updateLeaderboard() {
                const leaderboardEl = document.getElementById('leaderboard');
                
                if (this.leaderboard.length === 0) {
                    leaderboardEl.innerHTML = '<div class="text-gray-500 dark:text-gray-400 text-sm">No records yet. Be the first!</div>';
                    return;
                }
                
                leaderboardEl.innerHTML = this.leaderboard.map((entry, index) => `
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center py-3 px-3 ${index < 3 ? 'bg-yellow-50 dark:bg-yellow-900/20 rounded' : ''} space-y-1 sm:space-y-0">
                        <div class="flex items-center">
                            <span class="w-6 text-center font-semibold ${index === 0 ? 'text-yellow-600 dark:text-yellow-400' : index === 1 ? 'text-gray-500 dark:text-gray-400' : index === 2 ? 'text-orange-600 dark:text-orange-400' : 'text-gray-400 dark:text-gray-500'}">${index + 1}</span>
                            <span class="ml-3 font-medium text-gray-900 dark:text-white">${entry.username}</span>
                            <span class="ml-2 text-primary font-semibold">¬∑ ${entry.score}</span>
                        </div>
                        <div class="text-sm text-gray-500 dark:text-gray-400 ml-9 sm:ml-0">
                            ${entry.correct}/30 ¬∑ ${Math.floor(entry.time / 60)}:${(entry.time % 60).toString().padStart(2, '0')} ¬∑ ${entry.accuracy}%
                        </div>
                    </div>
                `).join('');
            }

            resetQuiz() {
                this.generateQuestions();
                this.showStartScreen();
                clearInterval(this.timerInterval);
            }

            showCustomAlert(message) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                        <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                        <div class="flex justify-end">
                            <button class="px-4 py-2 bg-primary text-white hover:bg-primary/90 rounded" onclick="this.closest('.fixed').remove()">OK</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            // Initialize Firebase
            initializeFirebase() {
                try {
                    // Your Firebase config goes here - replace with your actual config
                   const firebaseConfig = {
                      apiKey: "AIzaSyC7oUqB5Wi51WXAWEujHCvKgoAnEl-FGnk",
                      authDomain: "superfam-math-challenge.firebaseapp.com",
                      databaseURL: "https://superfam-math-challenge-default-rtdb.asia-southeast1.firebasedatabase.app",
                      projectId: "superfam-math-challenge",
                      storageBucket: "superfam-math-challenge.firebasestorage.app",
                      messagingSenderId: "436357852242",
                      appId: "1:436357852242:web:89dc79d92d34ba2b0c438b",
                      measurementId: "G-05VCEQ21EN"
                    };

                    // Initialize Firebase only if config is properly set
                    if (firebaseConfig.apiKey !== "your-api-key") {
                        firebase.initializeApp(firebaseConfig);
                        this.database = firebase.database();
                        this.firebaseInitialized = true;
                        console.log('Firebase initialized successfully');
                    } else {
                        console.log('Firebase config not set - falling back to localStorage');
                        this.firebaseInitialized = false;
                    }
                } catch (error) {
                    console.log('Firebase initialization failed - falling back to localStorage:', error);
                    this.firebaseInitialized = false;
                }
            }

            // Save leaderboard to Firebase or localStorage
            saveLeaderboard() {
                if (this.firebaseInitialized) {
                    try {
                        this.database.ref('leaderboard').set(this.leaderboard);
                        console.log('Leaderboard saved to Firebase successfully');
                    } catch (error) {
                        console.log('Firebase save failed - falling back to localStorage:', error);
                        this.saveToLocalStorage();
                    }
                } else {
                    this.saveToLocalStorage();
                }
            }

            // Load leaderboard from Firebase or localStorage
            loadLeaderboard() {
                if (this.firebaseInitialized) {
                    try {
                        this.database.ref('leaderboard').on('value', (snapshot) => {
                            const data = snapshot.val();
                            if (data && Array.isArray(data)) {
                                this.leaderboard = data;
                                this.updateLeaderboard();
                                console.log('Leaderboard loaded from Firebase successfully');
                            }
                        });
                    } catch (error) {
                        console.log('Firebase load failed - falling back to localStorage:', error);
                        this.loadFromLocalStorage();
                    }
                } else {
                    this.loadFromLocalStorage();
                }
            }

            // Fallback localStorage methods
            saveToLocalStorage() {
                try {
                    if (typeof(Storage) !== "undefined" && localStorage) {
                        localStorage.setItem('mathQuizLeaderboard', JSON.stringify(this.leaderboard));
                        console.log('Leaderboard saved to localStorage successfully');
                    }
                } catch (error) {
                    console.log('Cannot save leaderboard - localStorage not available:', error);
                }
            }

            loadFromLocalStorage() {
                try {
                    if (typeof(Storage) !== "undefined" && localStorage) {
                        const saved = localStorage.getItem('mathQuizLeaderboard');
                        if (saved) {
                            this.leaderboard = JSON.parse(saved);
                            console.log('Leaderboard loaded from localStorage successfully');
                        }
                    }
                } catch (error) {
                    console.log('Cannot load leaderboard - localStorage not available or data corrupted:', error);
                    this.leaderboard = []; // Reset to empty if data is corrupted
                }
            }
        }

        // Initialize the quiz when the page loads
        const quiz = new MathQuiz();
    </script>
</body>
</html>
